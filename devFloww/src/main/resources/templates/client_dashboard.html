<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Creation Modal</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      font-family: "Inter", sans-serif;
    }

    input.form-control {
      font-size: 0.9rem;
    }
    .tag_button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      padding: 3px 10px;
      border-radius: 20px;
      border: none;
      background-color: #e0e0e0;
      color: black;
      position: relative;
      cursor: pointer;
    }

    .tag_button.selected {
      background-color: black;
      color: white;
    }

    .close-icon {
      font-size: 12px;
      cursor: pointer;
      display: inline;
    }

    .tag_button .tag-text {
      display: inline;
    }

    ul.list-unstyled {
      list-style: none;
      padding-left: 0;
    }

    ul.list-unstyled button {
      margin-bottom: 5px;
    }
    label.form-label {
      font-size: 0.9rem !important;
    }
  </style>
</head>
<body>
  <h1>Hello, world!</h1>
  <button
    class="btn btn-primary"
    data-bs-toggle="modal"
    data-bs-target="#addProjectModal"
  >
    Add Project
  </button>

  <div
    class="modal fade"
    id="addProjectModal"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog" style="max-width: 50vw;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Project</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form th:action="@{/create_project}" method="POST" id="projectForm">
            <input type="hidden" name="userId" id="userIdInput" value="" />
            <div
              class="mb-3 d-flex align-items-center justify-content-between"
              style="gap: 1rem"
            >
              <label
                for="title"
                class="form-label mb-0"
                style="white-space: nowrap"
                >Project Title *</label
              >

              <div
                class="form-check form-switch d-flex align-items-center gap-2 mb-0"
              >
                <span id="visibilityIcon" style="color: gray">
                  <!-- unlock icon initially -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="13"
                    fill="currentColor"
                    class="bi bi-unlock-fill"
                    viewBox="0 0 16 16"
                    style="color: gray"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M12 0a4 4 0 0 1 4 4v2.5h-1V4a3 3 0 1 0-6 0v2h.5A2.5 2.5 0 0 1 12 8.5v5A2.5 2.5 0 0 1 9.5 16h-7A2.5 2.5 0 0 1 0 13.5v-5A2.5 2.5 0 0 1 2.5 6H8V4a4 4 0 0 1 4-4"
                    />
                  </svg>
                </span>
                <label
                  class="form-check-label mb-0"
                  style="font-size: 0.8rem; color: gray; margin-right: 3vw"
                  for="projectPrivate"
                  id="visibilityLabel"
                  >Public</label
                >
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="projectPrivate"
                  role="switch"
                />
              </div>
            </div>

            <div class="mb-3 mt-0 p-0">
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                required
                style="max-width: 20vw"
                placeholder="Title"
              />
            </div>
            <div class="mb-3">
              <label for="description" class="form-label"
                >Project Description *</label
              >
              <textarea
                class="form-control"
                id="description"
                name="description"
                rows="3"
                required
                placeholder="I am looking for..."
                style="font-size: 0.9rem"
              ></textarea>
            </div>

            <div class="mb-3 d-flex align-items-center gap-2">
              <div><input type="checkbox" id="showOfferPrice" name="showOfferPrice"/></div>
              <label
                for="showOfferPrice"
                class="form-label mb-0"
                style="font-size: 0.9rem"
              >
                Show Developer's Offer Price
              </label>
            </div>

            <div class="d-flex" style="gap: 1rem">
              <div class="mb-3" style="width: 12vw">
                <label class="form-label">Project Category *</label>
                <select
                  class="form-select"
                  id="category"
                  name="category"
                  required
                  style="font-size: 0.9rem"
                ></select>
              </div>
              <div class="mb-3" style="width: 12vw">
                <label class="form-label">Project Subcategory *</label>
                <select
                  class="form-select"
                  id="subcategory"
                  name="subcategory"
                  required
                  style="font-size: 0.9rem"
                  disabled
                ></select>
              </div>
            </div>

            <div class="d-flex align-items-end" style="gap: 1rem">
              <div class="mb-3" style="width: 12vw">
                <label class="form-label">Payment Type *</label>
                <select
                  class="form-select"
                  id="paymentType"
                  name="paymentType"
                  required
                  style="font-size: 0.9rem"
                ></select>
              </div>

              <div class="mb-3">
                <label for="maxPrice" class="form-label">Maximum Price (€)</label>
                <input
                  type="number"
                  class="form-control"
                  id="maxPrice"
                  name="maxPrice"
                  style="font-size: 0.9rem; width: 8vw"
                  min="0"
                  step="0.01"
                />
              </div>
            </div>

            <div class="d-flex align-items-end" style="gap: 1rem">
              <div class="mb-3" style="width: 12vw">
                <label class="form-label">Estimated Duration</label>
                <select
                  class="form-select"
                  id="estimatedDuration"
                  name="estimatedDuration"
                  style="font-size: 0.9rem"
                ></select>
              </div>

              <div class="mb-3" style="width: 20vw">
                <label for="offerDuration" class="form-label"
                  >Offer Duration (days)</label
                >
                <div
                  class="d-flex align-items-center"
                  style="gap: 1rem"
                >
                  <input
                    type="range"
                    class="form-range"
                    min="1"
                    max="30"
                    id="offerDurationDays"
                    name="offerDurationDays"
                    value="7"
                    oninput="offerDurationValue.innerText = this.value"
                    style="flex: 1"
                  />
                  <span style="white-space: nowrap; font-size: 0.8rem"
                    ><span id="offerDurationValue">7</span> day(s)</span
                  >
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Suggested Technologies</label>
              <ul class="list-unstyled d-flex flex-wrap gap-2" id="technologyTags">
                <!-- Tags will be injected here -->
              </ul>
              <!-- Hidden input to store selected technologies -->
              <input type="hidden" id="selectedTechnologies" name="selectedTechnologies" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button type="submit" form="projectForm" class="btn btn-primary">
            Save Project
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Enum-like objects to simulate your backend enums
    const ProjectCategory = {
      WEB_DEVELOPMENT: "Web Development",
      MOBILE_DEVELOPMENT: "Mobile Development",
      DATA_SCIENCE: "Data Science",
      MACHINE_LEARNING: "Machine Learning",
      DEVOPS: "DevOps",
      GAME_DEVELOPMENT: "Game Development",
      UI_UX_DESIGN: "UI/UX Design",
      OTHER: "Other",
    };

    // For each category, example subcategories (can be extended as needed)
    const ProjectSubcategory = {
      WEB_DEVELOPMENT: ["Portal", "Corporate Site", "E-Commerce", "Landing Page"],
      MOBILE_DEVELOPMENT: ["Android App", "iOS App", "Cross-platform App"],
      DATA_SCIENCE: ["Data Analysis", "Reporting", "ETL"],
      MACHINE_LEARNING: ["Model Training", "Model Deployment"],
      DEVOPS: ["CI/CD Pipeline", "Infrastructure Setup"],
      GAME_DEVELOPMENT: ["2D Games", "3D Games"],
      UI_UX_DESIGN: ["Wireframes", "Prototypes"],
      OTHER: ["Miscellaneous"],
    };

    const PaymentMethod = {
      HOURLY: "Hourly",
      TOTAL: "Total",
      MILESTONE: "Milestone",
    };

    const EstimatedDuration = {
      LESS_THAN_1_WEEK: "Less than 1 week",
      ONE_TO_FOUR_WEEKS: "1 - 4 weeks",
      ONE_TO_THREE_MONTHS: "1 - 3 months",
      THREE_TO_SIX_MONTHS: "3 - 6 months",
      SIX_TO_TWELVE_MONTHS: "6 - 12 months",
      OVER_A_YEAR: "Over a year",
      UNKNOWN: "I don't know",
    };

    const SuggestedTechnologies = [
      "JavaScript",
      "C++",
      "Java",
      "Python",
      "React",
      "C",
      "HTML",
      "CSS",
      "Spring",
      "Node.js",
      "Vue.js",
      "PHP",
      "Laravel",
      "Django",
      "Flask",
      "Kotlin",
      "Swift",
      "Angular",
      "TypeScript",
    ];

    // DOM elements
    const categorySelect = document.getElementById("category");
    const subcategorySelect = document.getElementById("subcategory");
    const paymentTypeSelect = document.getElementById("paymentType");
    const estimatedDurationSelect = document.getElementById("estimatedDuration");
    const technologyTagsContainer = document.getElementById("technologyTags");
    const selectedTechnologiesInput = document.getElementById("selectedTechnologies");
    const projectPrivateCheckbox = document.getElementById("projectPrivate");
    const visibilityIcon = document.getElementById("visibilityIcon");
    const visibilityLabel = document.getElementById("visibilityLabel");
    const userIdInput = document.getElementById("userIdInput");

    // Populate dropdown helper function
    function populateSelect(selectElement, options, defaultValue = null) {
      selectElement.innerHTML = "";
      for (const [key, value] of Object.entries(options)) {
        const option = document.createElement("option");
        option.value = key;
        option.textContent = value;
        selectElement.appendChild(option);
      }
      if (defaultValue && selectElement.querySelector(`option[value="${defaultValue}"]`)) {
        selectElement.value = defaultValue;
      } else {
        selectElement.selectedIndex = 0;
      }
    }

    // Populate category select
    populateSelect(categorySelect, ProjectCategory);

    // Populate payment type select
    populateSelect(paymentTypeSelect, PaymentMethod);

    // Populate estimated duration select
    populateSelect(estimatedDurationSelect, EstimatedDuration, "UNKNOWN");

    // Populate subcategories based on category
    function populateSubcategories(categoryKey) {
      if (!categoryKey || !ProjectSubcategory[categoryKey]) {
        subcategorySelect.innerHTML = "";
        subcategorySelect.disabled = true;
        return;
      }
      subcategorySelect.disabled = false;
      const subcategories = ProjectSubcategory[categoryKey];
      subcategorySelect.innerHTML = "";
      subcategories.forEach((subcat) => {
        const option = document.createElement("option");
        option.value = subcat;
        option.textContent = subcat;
        subcategorySelect.appendChild(option);
      });
      subcategorySelect.selectedIndex = 0;
    }

    // When category changes, update subcategories
    categorySelect.addEventListener("change", () => {
      populateSubcategories(categorySelect.value);
    });

    // Initialize subcategories with the first category on page load
    if (categorySelect.options.length > 0) {
      categorySelect.selectedIndex = 0;
      populateSubcategories(categorySelect.value);
    }

    // Populate technology tags
    function createTechnologyTags() {
      technologyTagsContainer.innerHTML = "";
      SuggestedTechnologies.forEach((tech) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className = "tag_button";
        button.innerHTML = `<span class="tag-text">${tech}</span> <span class="close-icon" style="display:none;">×</span>`;
        button.title = `Click to select/deselect ${tech}`;

        button.addEventListener("click", () => {
          button.classList.toggle("selected");
          updateSelectedTechnologies();
        });

        technologyTagsContainer.appendChild(button);
      });
    }

    // Update hidden input with selected technologies
    function updateSelectedTechnologies() {
      const selected = [];
      technologyTagsContainer.querySelectorAll(".tag_button.selected").forEach((btn) => {
        selected.push(btn.querySelector(".tag-text").textContent);
      });
      selectedTechnologiesInput.value = selected.join(",");
    }

    createTechnologyTags();

    // Toggle public/private icon and label on checkbox change
    projectPrivateCheckbox.addEventListener("change", () => {
      if (projectPrivateCheckbox.checked) {
        // Locked icon
        visibilityIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16" style="color: black;">
            <path d="M8 1a2 2 0 0 0-2 2v3h4V3a2 2 0 0 0-2-2zM3.5 6h9a.5.5 0 0 1 .5.5v7a2.5 2.5 0 0 1-5 0v-7a.5.5 0 0 1 .5-.5z"/>
          </svg>`;
        visibilityLabel.style.color = "black";
        visibilityLabel.textContent = "Private";
      } else {
        // Unlocked icon
        visibilityIcon.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-unlock-fill" viewBox="0 0 16 16" style="color: gray;">
            <path fill-rule="evenodd" d="M12 0a4 4 0 0 1 4 4v2.5h-1V4a3 3 0 1 0-6 0v2h.5A2.5 2.5 0 0 1 12 8.5v5A2.5 2.5 0 0 1 9.5 16h-7A2.5 2.5 0 0 1 0 13.5v-5A2.5 2.5 0 0 1 2.5 6H8V4a4 4 0 0 1 4-4"/>
          </svg>`;
        visibilityLabel.style.color = "gray";
        visibilityLabel.textContent = "Public";
      }
    });

    // On page load, read userId from URL and assign it to the hidden input
    function getUserIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("userId");
    }

    document.addEventListener("DOMContentLoaded", () => {
      const userIdFromUrl = getUserIdFromUrl();
      if (userIdFromUrl) {
        userIdInput.value = userIdFromUrl;
      }
    });
  </script>
</body>
</html>
